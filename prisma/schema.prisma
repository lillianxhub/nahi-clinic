// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model Clinic {
  clinic_id   Int      @id @default(autoincrement())
  clinic_name String
  address     String
  phone       String
  open_time   String
  close_time  String

  users      User[]
  patients   Patient[]
  treatments Treatment[]
  medicines  Medicine[]
  finances   Finance[]
}

model User {
  user_id   Int    @id @default(autoincrement())
  username  String @unique
  password  String
  role      String
  fullname  String

  clinic_id Int
  clinic    Clinic @relation(fields: [clinic_id], references: [clinic_id])

  treatments Treatment[]
  finances   Finance[]
}

model Patient {
  patient_id  Int    @id @default(autoincrement())
  national_id String @unique
  firstname   String
  lastname    String
  gender      String
  birthdate   DateTime
  phone       String

  clinic_id Int
  clinic    Clinic @relation(fields: [clinic_id], references: [clinic_id])

  treatments Treatment[]
}

model Treatment {
  treatment_id   Int      @id @default(autoincrement())
  treatment_date DateTime
  symptom        String   @db.Text
  diagnosis      String   @db.Text
  total_cost     Decimal  @db.Decimal(10, 2)

  clinic_id  Int
  patient_id Int
  user_id    Int

  clinic  Clinic  @relation(fields: [clinic_id], references: [clinic_id])
  patient Patient @relation(fields: [patient_id], references: [patient_id])
  user    User    @relation(fields: [user_id], references: [user_id])

  medicines TreatmentMedicine[]
}

model Medicine {
  medicine_id   Int      @id @default(autoincrement())
  medicine_name String
  stock         Int
  price         Decimal  @db.Decimal(10, 2)
  expire_date   DateTime

  clinic_id Int
  clinic    Clinic @relation(fields: [clinic_id], references: [clinic_id])

  treatments TreatmentMedicine[]
  purchases  MedicinePurchase[]
}

model TreatmentMedicine {
  tm_id        Int     @id @default(autoincrement())
  quantity     Int
  price        Decimal @db.Decimal(10, 2)

  medicine_id  Int
  treatment_id Int

  medicine  Medicine  @relation(fields: [medicine_id], references: [medicine_id])
  treatment Treatment @relation(fields: [treatment_id], references: [treatment_id])
}

model MedicinePurchase {
  purchase_id   Int      @id @default(autoincrement())
  quantity      Int
  cost          Decimal  @db.Decimal(10, 2)
  purchase_date DateTime

  medicine_id Int
  medicine    Medicine @relation(fields: [medicine_id], references: [medicine_id])
}

model Finance {
  finance_id Int     @id @default(autoincrement())
  type       FinanceType 
  amount     Decimal @db.Decimal(10, 2)
  date       DateTime

  clinic_id Int
  user_id   Int

  clinic Clinic @relation(fields: [clinic_id], references: [clinic_id])
  user   User   @relation(fields: [user_id], references: [user_id])
}

enum FinanceType {
  INCOME
  EXPENSE
}