generator client {
  provider = "prisma-client"
  output   = "generated/prisma"
}

datasource db {
  provider = "mysql"
}

enum Role {
  ADMIN
  STAFF
}

enum FinanceType {
  INCOME
  EXPENSE
}

model Clinic {
  clinic_id   String   @id @default(uuid())
  clinic_name String
  address     String
  phone       String
  open_time   DateTime @db.Time
  close_time  DateTime @db.Time

  users      User[]
  patients   Patient[]
  treatments Treatment[]
  medicines  Medicine[]
  finances   Finance[]
}

model User {
  user_id   String @id @default(uuid())
  username  String @unique
  password  String
  email     String?
  role      Role
  fullname  String

  clinic_id String
  clinic    Clinic @relation(fields: [clinic_id], references: [clinic_id])

  treatments Treatment[]
  finances   Finance[]
}

model Patient {
  patient_id  String @id @default(uuid())
  national_id String @unique
  firstname   String
  lastname    String
  gender      String
  birthdate   DateTime
  phone       String

  clinic_id String
  clinic    Clinic @relation(fields: [clinic_id], references: [clinic_id])

  treatments Treatment[]
}

model Treatment {
  treatment_id   String   @id @default(uuid())
  treatment_date DateTime
  symptom        String   @db.Text
  diagnosis      String   @db.Text
  total_cost     Decimal  @db.Decimal(10, 2)

  clinic_id  String
  patient_id String
  user_id    String

  clinic  Clinic  @relation(fields: [clinic_id], references: [clinic_id])
  patient Patient @relation(fields: [patient_id], references: [patient_id])
  user    User    @relation(fields: [user_id], references: [user_id])

  medicines TreatmentMedicine[]
}

model Medicine {
  medicine_id   String   @id @default(uuid())
  medicine_name String
  stock         Int
  price         Decimal  @db.Decimal(10, 2)
  expire_date   DateTime

  clinic_id String
  clinic    Clinic @relation(fields: [clinic_id], references: [clinic_id])

  treatments TreatmentMedicine[]
  purchases  MedicinePurchase[]
}

model TreatmentMedicine {
  tm_id        String  @id @default(uuid())
  quantity     Int
  price        Decimal @db.Decimal(10, 2)

  medicine_id  String
  treatment_id String

  medicine  Medicine  @relation(fields: [medicine_id], references: [medicine_id])
  treatment Treatment @relation(fields: [treatment_id], references: [treatment_id])
}

model MedicinePurchase {
  purchase_id   String   @id @default(uuid())
  quantity      Int
  cost          Decimal  @db.Decimal(10, 2)
  purchase_date DateTime

  medicine_id String
  medicine    Medicine @relation(fields: [medicine_id], references: [medicine_id])
}

model Finance {
  finance_id String   @id @default(uuid())
  type       FinanceType
  amount     Decimal  @db.Decimal(10, 2)
  date       DateTime

  clinic_id String
  user_id   String

  clinic Clinic @relation(fields: [clinic_id], references: [clinic_id])
  user   User   @relation(fields: [user_id], references: [user_id])
}
